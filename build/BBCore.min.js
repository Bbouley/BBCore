/*! BBCore 2015-02-05 */
function jQLoader(){var a=document.createElement("script");a.setAttribute("src","//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"),document.getElementsByTagName("body").appendChild(a)}"undefined"==typeof jQuery&&jQLoader();var BBCore=function(a,b){return a.CONFIG={VERSION:"1.0",API_END_POINT:"/app/api/api.php",SERVER_API_URL:"https://app.bombbomb.com"},a.prototype.__updateSession=function(a,b){"success"===a.status?(this.userId=a.info.user_id,this.clientId=a.info.client_id,this.accessToken=a.info.api_key,this.hasContext=!0,this.authenticated=!0,this.storeKey(this.accessToken),console.log("bbcore: __updateSession session updated."),b&&b.call(this,a)):alert(a.status+" occurred while trying to login.")},a.prototype.onError=function(a,b){"function"==typeof a?this.onerror=a:this.onerror&&this.onerror.call(this,a,b)},a.prototype.login=function(a,b,c){if("function"==typeof a&&(c=a,a=this.storage.getItem("b2-uid"),b=this.storage.getItem("b2-pwd")),a){this.userEmail=a;var d=this;this.sendRequest({method:"ValidateSession",email:a,pw:b},function(a){d.__updateSession(a,c)})}},a.prototype.logout=function(){this.storage.removeItem("b2-uid"),this.storage.removeItem("b2-pwd"),this.storage.removeItem("access_token"),this.hasContext=!1,this.authenticated=!1},a.prototype.credentialsSaved=function(){return null!==this.storage.getItem("b2-uid")?null!=this.storage.getItem("b2-uid"):this.storage.getItem("access_token")},a.prototype.saveCredentials=function(a,b){this.storage.setItem("b2-uid",a),this.storage.setItem("b2-pwd",b)},a.prototype.resumeStoredSession=function(a,b){this.accessToken=window.storage.getItem("access_token"),this.accessToken?this.validateAccessToken(a):window.storage.getItem("b2-uid")?this.login(a):(console.log("bbcore: unable to resume session."),b())},a.prototype.validateAccessToken=function(a){var b=this;this.sendRequest({method:"ValidateSession",api_key:this.accessToken,async:!1},function(c){b.__updateSession(c,a)})},a.prototype.isAuthenticated=function(){return this.authenticated||console.log("You must authenticate a BombBomb session before making additional calls."),this.authenticated},a.prototype.invalidateSession=function(){that=this,this.sendRequest({method:"invalidateKey"},function(){that.accessToken="",that.authenticated=!1,that.hasContext=!1})},a.prototype.getServerUrl=function(){return this.apiServer||a.CONFIG.SERVER_API_URL},a.prototype.getRequestUrl=function(){return this.getServerUrl()+a.CONFIG.API_END_POINT},a.prototype.sendRequest=function(a,c,d){if("function"==typeof c&&(d=c),"object"==typeof a&&(c=a),"object"==typeof a&&c.method&&(a=c.method),"IsValidLogin"==a||c.api_key||(c.api_key=this.accessToken),"ValidateSession"!=a&&!this.authenticated)return this.onError.call(this,{status:"failure",methodName:"InvalidSession",info:{errormsg:"Invalid login"}},null),!1;var e=this,f=!0;return"undefined"!=typeof c.async&&(f=c.async),b.ajax({url:c.url?c.url:this.getRequestUrl(),async:f,type:"post",dataType:"json",crossDomain:!0,data:c,success:function(b){e.lastresponse=b.status,"success"===b.status?("GetVideoGuid"===a&&b.info&&b.info.video_id&&(this.currentVideoId=b.info.video_id),d&&d.call(e,b)):e.onError.call(e,b)},error:function(a){var b={status:"unknown",jqXHR:a};"undefined"!=typeof a.responseJSON&&(b=a.responseJSON),e.lastresponse=b.status,"success"==b.status?d.call(e,b,a):e.onError.call(e,b,a)}})},a.prototype.verifyKey=function(a,b){this.sendRequest({method:"GetEmails",api_key:a},function(a){b||b({isValid:"success"==a.status})})},a.prototype.storeKey=function(a){this.accessToken||(this.accessToken=a),this.accessToken&&this.storage.setItem("access_token",this.accessToken)},a.prototype.getKey=function(){return this.accessToken},a.prototype.saveRecording=function(a){pVals=a,pVals.vid_id&&this.sendRequest({method:"VideoRecordedLive"},pVals,function(){})},a.prototype.setVideoId=function(a){this.currentVideoId=a},a.prototype.getVideoId=function(a){this.currentVideoId?a&&a.call(this,this.currentVideoId):this.getNewVideoGuid(a)},a.prototype.hasVideoId=function(){return this.currentVideoId},a.prototype.getNewVideoGuid=function(a){var b=this;this.sendRequest({method:"GetVideoGuid"},function(c){b.currentVideoId=c.info.video_id,a&&a.call(this,b.currentVideoId)})},a.prototype.videoQuickSend=function(a,b){var c={method:"VideoQuickSend",subject:"QuickSend from BombBomb",mobile_message:"",email_address:null,videoId:null},d=[];for(var e in c)a[e]||(a[e]=c[e]);a.message&&!a.mobile_message&&(a.mobile_message=a.message),a.email&&!a.email_address&&(a.email_address=a.email),a.email_address&&!a.email_addresses&&(a.email_addresses=a.email_address),!a.video_id&&this.currentVideoId&&(a.video_id=this.currentVideoId),a.video_id||d.push("quickSendVideo Error: no video_id defined."),a.subject||d.push("quickSendVideo Error: no subject defined."),a.email_addresses||d.push("quickSendVideo Error: no email_address defined."),d.length>0&&!a.video_id?this.getVideoId(function(c){c?(a.video_id=c,this.sendRequest(a,b)):(d.push("quickSendVideo: Terminal Error: Unable to set video_id"),this.onError({info:{errmsg:d}}))}):this.sendRequest(a,b)},a.prototype.getEmbeddedRecorderUrl=function(a,c){"function"==typeof a&&(c=a,a=null);var d={height:240,width:340,force_ssl:!1};a=a||d;var e=b.extend({},a,{module:"videos",page:"EmbeddedRecorder",popup:1,nohtml:1,api_key:this.getKey()}),f=this;this.getVideoId(function(a){var d=f.getServerUrl()+"/app/?module=login&actn=login&api_key="+f.getKey()+"&redir="+btoa(f.getServerUrl()+"/app/?"+b.param(e)+(a?"&vguid="+a:""));c.call(this,{url:d,video_id:a})})},a.prototype.getVideoRecorder=function(a,c){"function"==typeof a&&(c=a,a=null);var d={height:240,width:340,force_ssl:!1,start:null,stop:null,recorded:null};return a=a||{},b.extend(a,d),this.isAuthenticated()?(a.method="GetVideoRecorder",void this.sendRequest(a,function(a){console.log("GetVideoRecorder returned, calling callback"),console.log(c),c&&c.call(this,a)})):void this.onError({message:"Must authenticate session before invoking methods."})},a.prototype.startVideoRecorder=function(a,c){"function"==typeof a&&(c=a,a=null);var d={type:"embedded",target:null,height:240,width:340,force_ssl:!1,recorderLoaded:null,recordComplete:c};a=a||d,a.recordComplete&&!c&&(c=a.recordComplete),this.__vidRecHndl=a.target?b(a.target):b("body").append('<div id="b2recorder"></div>');var e=a;delete e.type,delete e.target,delete e.recordComplete,delete e.recorderLoaded;var f=this;this.getVideoRecorder(e,function(b){!f.currentVideoId&&b.info.vid_id&&(f.currentVideoId=b.info.vid_id),console.log("startVideoRecorder :"+f.currentVideoId),f.__vidRecHndl.html(b.info.content),a.recorderLoaded&&a.recorderLoaded.call(f,b.info)}),window.bbStreamStartRecord=function(a,b){console.log("bbStreamStartRecord triggered"),f.liveStreamStartRecord.call(f,a,b)},window.bbStreamStopRecord=function(a){console.log("bbStreamStopRecord triggered"),f.liveStreamStopRecord.call(f,a)},window.reportVideoRecorded=function(a,b){console.log("reportVideoRecorded triggered"),c({videoId:f.currentVideoId,filename:a,log:b})}},a.prototype.destroyVideoRecorder=function(){this.__vidRecHndl&&this.__vidRecHndl.remove(),window.bbStreamStartRecord=null,window.bbStreamStopRecord=null,window.reportVideoRecorded=null},a.prototype.liveStreamStartRecord=function(a,b){this.__vidRecording=!0,this.sendRequest({method:"liveStreamStartRecord",streamname:a,filename:b})},a.prototype.liveStreamStopRecord=function(a){this.__vidRecording=!1,this.sendRequest({method:"liveStreamStopRecord",streamname:a})},a.prototype.getVideoDeliveryUrl=function(a){a=b.extend({video_id:"",autoplay:1},a);var c=this.getServerUrl().indexOf("dev")>0?"dev.":this.getServerUrl().indexOf("local")>0?"local.":"";return"http://"+c+"bbemaildelivery.com/bbext/?p=video_land&id="+a.video_id+"&autoplay="+a.autoplay},a.prototype.saveRecordedVideo=function(a,b,c,d){var e=b||this.currentVideoId,f=this;this.sendRequest({method:"VideoRecordedLive",title:a,filename:c,vid_id:e},function(a){d.call(f,a)})},a.prototype.uploadVideo=function(){},a.prototype.getVideo=function(a,b){a&&this.sendRequest({method:"GetVideos",video_id:a},b)},a.prototype.getVideos=function(a,c){var d={updatedSince:"",page:"",pageSize:""};"function"==typeof a&&(c=a,a={});var e=b.extend({},d,a);e.method="GetVideos",(e.page.length||e.page>0)&&(e.method="GetVideosPaged"),this.sendRequest(e,c)},a.prototype.getVideoStatus=function(a,b){a&&this.sendRequest({method:"getVideoStatus",id:a},b)},a.prototype.getEncodingReport=function(a,b){a&&this.sendRequest({method:"getEncodingReport",id:a},b)},a.prototype.deleteVideo=function(a,b){this.sendRequest({method:"DeleteVideo",video_id:a},b)},a.prototype.getLists=function(a){this.sendRequest({method:"GetLists"},a)},a.prototype.createList=function(a,b){this.sendRequest({method:"createList",name:a},b)},a.prototype.getEmails=function(a){this.sendRequest({method:"GetEmails"},a)},a.prototype.getContact=function(a,c){if(a){var d={width:340,force_ssl:!1},e=b.extend({},d,{contact_id:a,method:"GetContact"});this.sendRequest(e,c)}},a.prototype.findContact=function(a,c){var d=b.extend({},defaults,{contact_id:contactId,method:"GetContact"});this.sendRequest(d,c)},a.prototype.getListContacts=function(a,b){listid&&this.sendRequest({method:"GetListContacts",list_id:a},b)},a.prototype.addContact=function(a,b){"object"==typeof a&&this.sendRequest({method:"AddContact",contact:a},b)},a.prototype.bulkAddContacts=function(a,b){a=a||{},a.method="BulkAddContacts","object"==typeof a.contacts&&(a.contacts=JSON.stringify(a.contacts)),this.sendRequest(a,b)},a.prototype.updateContact=function(a,b){a=a||{},a.method="UpdateContact",this.sendRequest(a,b)},a.prototype.getDrips=function(a,b){a=a||{},a.method="GetDrips",this.sendRequest(a,b)},a.prototype.getForms=function(a,b){a=a||{},a.method="GetForms",this.sendRequest(a,b)},a.prototype.getImportAddressesByType=function(a,c){a=b.extend({method:"getImportAddressesByType"},a),a.type||this.onError({info:{errmsg:["A Type must be provided."]}}),this.sendRequest(a,c)},a.prototype.addContactImportAddress=function(a,c){a=b.extend({method:"addContactImportAddress"},a),a.importAddrCode&&a.importAddrName||this.onError({info:{errmsg:["An Import Address Code and Import Address Name must be provided."]}}),this.sendRequest(a,c)},a.prototype.deleteContactImportAddress=function(a,c){a=b.extend({importAddrCode:1,method:"deleteContactImportAddress"},a),a.importAddrCode||this.onError({info:{errmsg:["Invalid Import Address Code"]}}),this.sendRequest(a,c)},a.prototype.getClientRecentInteractions=function(a,b){a=a||{},a.activitySince=a.activitySince||"",a.method="GetClientRecentInteractions",this.sendRequest(a,b)},a.prototype.getClientIntegrations=function(a){this.sendRequest({method:"getClientIntegrations"},a)},a.prototype.sendCustomVideoEmail=function(a,c){var d={html_content:null,subject:"",email:"",email_id:"",from_name:""},e=b.extend({},d,a);!e.email.length&&!e.email_id.length,this.sendRequest(b.extend(e,{method:"SendCustomVideoEmail"}),c)},a.prototype.ver=function(){return a.CONFIG.VERSION},a}(function(a){this.userEmail="",this.userId="",this.clientId="",this.accessToken="",this.currentVideoId=null,this.email=null,this.apiServer=null,this.onerror=null,$.extend({},this,a),this.authenticated=!1,this.hasContext=!1,this.storage=localStorage||window.storage,this.CONTENT={QUICKSEND:""},this.lastresponse="",this.__vidRecording=!1,this.__vidRecHndl=null,this.recording=function(a){this.vid_id="",this.title="",this.filename="",$.extend({},this,a)},this.contact=function(a){this.email="",this.firstname="",this.lastname="",this.phone="",this.phone_number="",this.address_line_1="",this.address_line_2="",this.city="",this.state="",this.country="",this.postal_code="",this.company="",this.position="",this.comments="",$.extend({},this,a),this.eml=this.email},this.contacts=function(){},this.contacts.prototype=Array.prototype,this.contacts.constructor=this.contact,this.recordings=function(){},this.recordings.prototype=Array.prototype,this.recordings.constructor=this.recording,this.accessToken&&this.validateAccessToken(),this.email&&this.password&&this.login(this.email,this.password)},jQuery);